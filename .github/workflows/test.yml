name: System Info

on: [push, pull_request]

jobs:
  check-system-info:
    name: ${{ matrix.os }} Info
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    steps:
      - uses: actions/checkout@v4

      - name: Run System Info Script
        if: runner.os != 'Windows'
        run: bash claw.sh

      - name: Uninstall Node.js (Ubuntu Clean Test)
        if: runner.os == 'Linux'
        run: |
          sudo apt-get remove -y nodejs npm || true
          sudo rm -rf /usr/local/lib/node_modules
          sudo rm -rf /usr/local/bin/node
          sudo rm -rf /opt/hostedtoolcache/node* || true

      - name: Run Install Script (Clean Linux)
        if: runner.os == 'Linux'
        run: bash install.sh --no-prompt --no-onboard

      - name: Clean Environment (macOS)
        if: runner.os == 'macOS'
        run: |
          # Uninstall Node.js
          sudo rm -rf $(which node) || true
          sudo rm -rf /usr/local/bin/node /usr/local/lib/node_modules
          sudo rm -rf /opt/homebrew/bin/node
          sudo rm -rf /opt/hostedtoolcache/node* || true
          
          # Uninstall Homebrew (Manual force remove to avoid script prompts/cancellations)
          sudo rm -rf /opt/homebrew
          sudo rm -rf /usr/local/Homebrew
          sudo rm -rf /usr/local/bin/brew
          sudo rm -rf /usr/local/var/homebrew
          
          # Remove Git (Brew/User version only, implies system git /usr/bin/git remains)
          sudo rm -rf /usr/local/bin/git
          sudo rm -rf /opt/homebrew/bin/git
          
          [ -f ~/.bash_profile ] && source ~/.bash_profile || true
          [ -f ~/.zshrc ] && source ~/.zshrc || true
          
      - name: Run Install Script (Clean macOS)
        if: runner.os == 'macOS'
        run: bash install.sh --no-prompt --no-onboard

  test-clean-linux:
    name: Clean Install (Ubuntu Docker)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run Install in Clean Docker Container
        run: |
          docker run --rm -v "$(pwd):/app" ubuntu:24.04 bash -c "
            apt-get update && apt-get install -y curl && 
            cd /app && 
            bash install.sh --no-prompt --no-onboard
          "


